"use strict";angular.module("myApp",["ngRoute","httpInterceptorModule","MessageCenter","myApp.home","myApp.gallery","myApp.login","myApp.profile","myApp.metadata","globalsModule","fileModule","ngFileUpload"]).config(["$routeProvider",function(e){e.otherwise({redirectTo:"/home"})}]).config(["$httpProvider",function(e){e.defaults.withCredentials=!0,e.defaults.useXDomain=!0}]),angular.module("globalsModule",[]).factory("globals",function(e){var t={},n="http://localhost:8080/irods-cloud-backend/";return t.backendUrl=function(e){return n+e},t.lastPath=null,t.loggedInIdentity=null,t.setLastPath=function(e){this.lastPath=e},t.getLastPath=function(){return this.lastPath},t.getLoggedInIdentity=function(){return this.loggedInIdentity},t.setLoggedInIdentity=function(e){this.loggedInIdentity=e},t}).factory("breadcrumbsService",function(e,t){var n={};return n.currentAbsolutePath=null,n.pathComponents=[],n.setCurrentAbsolutePath=function(e){return e?(this.currentAbsolutePath=e,t.info("path:"+e),this.pathComponents=this.pathToArray(e),void t.info("path components set:"+this.pathComponents)):void this.clear()},n.pathToArray=function(e){if(!e)return t.info("no pathin"),[];var n=e.split("/");return t.info("array orig is:"+n),0==n.length?[]:(n.shift(),n)},n.buildPathUpToIndex=function(e){var n=this.getWholePathComponents();if(!n)throw t.error("no path components, cannot go to breadcrumb"),"cannot build path";for(var a="",o=0;o<=e;o++)n[o]&&(a=a+"/"+n[o]);return t.info("got total path:"+a),a},n.getWholePathComponents=function(){return this.pathComponents?this.pathComponents:[]},n.clear=function(){this.currentAbsolutePath=null,this.pathComponents=[]},n}),angular.module("httpInterceptorModule",[]).factory("myHttpResponseInterceptor",["$q","$location","$log","MessageService","globals",function(e,t,n,a,o){return{request:function(t){return t||e.when(t)},requestError:function(t){return e.reject(t)},response:function(t){return n.info(t),t||e.when(t)},responseError:function(i){n.error(i);var r=i.status;if(401==r)"/login"!=t.path()&&(n.info("intercepted unauthorized, save the last path"),o.setLastPath(t.path()),n.info("saved last path:"+t.path()),a.warn("Please log in")),t.path("/login");else{if(400==r){var l=i.data.errors.errors.length;if(l>0)for(var s=0;s<l;s++)a.warn(i.data.errors.errors[s].message);return e.reject(i)}if(i&&i.data){var c=i.data.error;c&&null!=c||(c="unknown exception occurred"),n.error("unknown exception, message is:"+c),a.error(c)}else{var c="unknown exception occurred";n.error("unknown exception, but with rejection, which was:"+i.data),a.error(c)}}return e.reject(i)}}}]).config(["$httpProvider",function(e){e.interceptors.push("myHttpResponseInterceptor")}]),angular.module("fileModule",[]).factory("fileService",["$http","$log","$q","globals",function(e,t,n,a){return{retrieveDataProfile:function(o){if(t.info("retriveDataProfile()"),!o)throw t.error("absolutePath is missing"),"absolutePath is missing";var i=n.defer();return e({method:"GET",url:a.backendUrl("file"),params:{path:o}}).success(function(e,n,a,o){i.resolve(e),t.info("return from call to get fileBasics:"+e)}).error(function(){return null}),i.promise},starFileOrFolder:function(n){if(t.info("starFileOrFolder()"),!n)throw t.error("absolutePath is missing"),"absolutePath is missing";var o=e({method:"PUT",url:a.backendUrl("star"),params:{path:n}}).then(function(e){return t.info(e),e.data});return o},unstarFileOrFolder:function(n){if(t.info("unstarFileOrFolder()"),!n)throw t.error("absolutePath is missing"),"absolutePath is missing";var o=e({method:"DELETE",url:a.backendUrl("star"),params:{path:n}}).then(function(e){return t(e),e.data});return o},moveFileOrFolder:function(n,o,i){if(t.info("move()"),!n)throw t.error("sourcePath is missing"),"sourcePath is missing";o||(o=""),i||(i="");var r=e({method:"POST",url:a.backendUrl("move"),params:{sourcePath:n,targetPath:o,resource:i}}).then(function(e){return t(e),e.data});return r},copyFileOrFolder:function(n,o,i,r){if(t.info("copy()"),!n)throw t.error("sourcePath is missing"),"sourcePath is missing";if(!o)throw t.error("targetPath is missing"),"targetPath is missing";i||(i=""),r||(r=!1);var l=e({method:"POST",url:a.backendUrl("copy"),params:{sourcePath:n,targetPath:o,resource:i,overwrite:r}}).then(function(e){return t(e),e.data});return l}}}]),angular.module("myApp.home",["ngRoute","ngFileUpload"]).config(["$routeProvider",function(e){e.when("/home/:vcName",{templateUrl:"home/home.html",controller:"homeCtrl",resolve:{selectedVc:function(e,t){var n=t.listUserVirtualCollectionData(e.current.params.vcName);return n},pagingAwareCollectionListing:function(e,t){var n=e.current.params.vcName,a=e.current.params.path;return null==a&&(a=""),t.listCollectionContents(n,a,0)}}}).when("/home",{templateUrl:"home/home.html",controller:"homeCtrl",resolve:{selectedVc:function(e){return null},pagingAwareCollectionListing:function(e,t){return{}}}})}]).directive("onLastRepeat",function(){return function(e,t,n){e.$last&&setTimeout(function(){e.$emit("onRepeatLast",t,n)},1)}}).controller("homeCtrl",["$scope","Upload","$log","$http","$location","MessageService","globals","breadcrumbsService","downloadService","virtualCollectionsService","collectionsService","fileService","metadataService","selectedVc","pagingAwareCollectionListing",function(e,t,n,a,o,i,r,l,s,c,d,u,p,_,f){e.selectedVc=_,e.pagingAwareCollectionListing=f.data,e.$on("onRepeatLast",function(t,n,a){$(".selectable").selectable({stop:function(){$(".list_content").removeClass("ui-selected");var t=$("#select-result").empty(),n=$("#copy_select_result").empty();if(1==$(".copy_list_item.ui-selected").length){var a=$(".copy_list_item.ui-selected").children(".list_content").children(".collection_object").text();n.append(a),e.copy_target=$(".copy_list_item.ui-selected").attr("id")}if($(".copy_list_item.ui-selected").length>1){$(".copy_list_item.ui-selected").not(":first").removeClass("ui-selected");var a=$(".copy_list_item.ui-selected").children(".list_content").children(".collection_object").text();n.append(a),e.copy_target=$(".copy_list_item.ui-selected").attr("id")}if($("li.ui-selected").length>1)t.append($(".ui-selected").length+" files"),$(".download_button").fadeIn(),$(".download_divider").fadeIn(),$(".rename_button").fadeOut(),$(".rename_divider").fadeOut(),$(".tablet_download_button").fadeIn(),$(".tablet_rename_button").fadeOut(),$(".empty_selection").fadeOut();else if(1==$("li.ui-selected").length){var o=$(".ui-selected").children(".list_content").children(".data_object").text();t.append(o),$(".download_button").fadeIn(),$(".rename_button").fadeIn(),$(".rename_divider").fadeIn(),$(".download_divider").fadeIn(),$(".tablet_download_button").fadeIn(),$(".tablet_rename_button").fadeIn(),$(".empty_selection").fadeOut()}else 0==$("li.ui-selected").length&&($(".download_button").fadeOut(),$(".rename_button").fadeOut(),$(".rename_divider").fadeOut(),$(".download_divider").fadeOut(),$(".tablet_download_button").fadeOut(),$(".tablet_rename_button").fadeOut(),$(".empty_selection").fadeIn())}})}),e.$watch("files",function(){e.upload(e.files)}),e.multiple=!0,e.upload=function(a){if(a&&a.length){$(".upload_container").css("display","none"),$(".upload_container_result").css("display","block");for(var o=0;o<a.length;o++){var i=a[o];$(".upload_container_result ul").append('<li id="uploading_item_'+o+'" class="light_back_option_even"><div class="col-xs-7 list_content"><img src="images/data_object_icon.png">'+i.name+"</div></li>"),t.upload({url:r.backendUrl("file"),fields:{collectionParentName:e.pagingAwareCollectionListing.pagingAwareCollectionListingDescriptor.parentAbsolutePath},file:i}).progress(function(e){var t=parseInt(100*e.loaded/e.total);n.info(t)}).success(function(e,t,n,a){console.log("file "+a.file.name+"uploaded. Response: "+e)})}}},e.listVirtualCollections=function(){return n.info("getting virtual colls"),a({method:"GET",url:r.backendUrl("virtualCollection")}).success(function(t){e.virtualCollections=t}).error(function(){e.virtualCollections=[]})},e.selectVirtualCollection=function(e,t){return n.info("selectVirtualCollection()"),e?(n.info("list vc contents for vc name:"+e),o.path("/home/"+e),void o.search("path",t)):void i.danger("missing vcName")},e.getBreadcrumbPaths=function(){return e.pagingAwareCollectionListing?(l.setCurrentAbsolutePath(e.pagingAwareCollectionListing.pagingAwareCollectionListingDescriptor.parentAbsolutePath),l.getWholePathComponents()):[]},e.pagingAwareCollectionListing&&e.pagingAwareCollectionListing.pagingAwareCollectionListingDescriptor.pathComponents&&(e.current_collection_index=e.pagingAwareCollectionListing.pagingAwareCollectionListingDescriptor.pathComponents.length-1),e.delete_action=function(){var e=$(".ui-selected"),t="";return e.each(function(){void 0!=$(this).attr("id")&&(t+="path="+$(this).attr("id")+"&")}),t=t.substring(0,t.length-1),n.info("Deleting:"+t),a({method:"DELETE",url:r.backendUrl("file")+"?"+t}).success(function(e){alert("Deletion completed"),location.reload()})},e.copy_source="",e.copy_target="",e.copy_action=function(){return e.copy_source=$(".general_list_item .ui-selected").attr("id"),e.copy_target=$(".copy_list_item.ui-selected").attr("id"),n.info("||||||||||||| copying:"+e.copy_source+" to "+e.copy_target),a({method:"POST",url:r.backendUrl("copy"),params:{sourcePath:e.copy_source,targetPath:e.copy_target,resource:"",overwrite:"false"}}).success(function(){location.reload()})},e.rename_action=function(){var e=$(".ui-selected").attr("id"),t=$("#new_renaming_name").val();return n.info("Renaming:"+e),a({method:"PUT",url:r.backendUrl("rename"),params:{path:e,newName:t}}).success(function(e){location.reload()})},e.create_collection_action=function(){var t=$("#new_collection_name").val();return n.info("Adding:"+t),a({method:"PUT",url:r.backendUrl("file")+"?path="+e.pagingAwareCollectionListing.pagingAwareCollectionListingDescriptor.parentAbsolutePath+"/"+t}).success(function(e){location.reload()})},e.getDownloadLink=function(){$(".list_content").removeClass("ui-selected");var e=$(".ui-selected");n.info(e);var t="";if(1==e.length){var a=$(".ui-selected").attr("id");window.open(r.backendUrl("download")+"?path="+a,"_blank")}else e.each(function(){if(void 0!=$(this).attr("id")){var e=$(this).attr("id");t+="path="+e+"&"}}),t=t.substring(0,t.length-1),window.open(r.backendUrl("download")+"?"+t,"_blank")},e.copy_pop_up_open=function(){return $(".pop_up_window").fadeIn(100),e.name_of_selection=$(".ui-selected"),e.name_of_selection.each(function(){void 0!=$(this).attr("id")&&($(this).hasClass("data_true")?$(".copy_container ul").append('<li class="light_back_option_even"><div class="col-xs-7 list_content"><img src="images/data_object_icon.png">'+$(this).attr("id")+"</div></li>"):$(".copy_container ul").append('<li class="light_back_option_even"><div class="col-xs-7 list_content"><img src="images/collection_icon.png">'+$(this).attr("id")+"</div></li>"))}),$(".copier").fadeIn(100),$(".copier_button").fadeIn(100),a({method:"GET",url:r.backendUrl("virtualCollection")}).success(function(t){e.copy_vc_list=t}).error(function(){alert("Something went wrong while fetching the Virtual Collections"),e.copy_vc_list=[]})},e.copy_list_refresh=function(t,n){return e.copyVC=t,a({method:"GET",url:r.backendUrl("collection/")+t,params:{path:n,offset:0}}).success(function(t){e.copy_list=t,$("#copy_select_result").empty()}).error(function(){alert("Something went wrong while fetching the contents of the Collection"),e.copy_list=[]})},e.create_pop_up_open=function(){$(".pop_up_window").fadeIn(100),$(".creater").fadeIn(100)},e.rename_pop_up_open=function(){$(".pop_up_window").fadeIn(100),$(".renamer").fadeIn(100);var e=$(".ui-selected").children(".list_content").children(".data_object").text();$(".selected_object").append(e)},e.upload_pop_up_open=function(){$(".pop_up_window").fadeIn(100),$(".uploader").fadeIn(100)},e.delete_pop_up_open=function(){$(".pop_up_window").fadeIn(100);var e=$(".ui-selected");e.each(function(){void 0!=$(this).attr("id")&&$(".delete_container ul").append('<li class="light_back_option_even"><div class="col-xs-7 list_content"><img src="images/data_object_icon.png">'+$(this).attr("id")+"</div></li>")}),$(".deleter").fadeIn(100)},e.pop_up_close=function(){$(".pop_up_window").fadeOut(100,function(){$(".upload_container").css("display","block"),$(".upload_container_result").html("<ul></ul>"),$(".upload_container_result").css("display","none"),$(".uploader").fadeOut(100),$(".deleter").fadeOut(100),$(".creater").fadeOut(100),$(".renamer").fadeOut(100),$(".copier").fadeOut(100),$(".copier_button").fadeOut(100),location.reload()})},e.goToBreadcrumb=function(e){return e?(o.path("/home/root"),void o.search("path",l.buildPathUpToIndex(e))):void n.error("cannot go to breadcrumb, no index")},e.green_action_toggle=function(e){var t=e.currentTarget.nextElementSibling,n=e.currentTarget.parentElement;$(t).toggle("normal"),$(n).toggleClass("green_toggle_container_open")};var h="yes";e.side_nav_toggle=function(){"no"==h?(h="yes",$(".side_nav_options").animate({opacity:"0"}),$("#side_nav").removeClass("uncollapsed_nav"),$("#side_nav").addClass("collapsed_nav"),$("#main_contents").removeClass("uncollapsed_main_content"),$("#main_contents").addClass("collapsed_main_content"),$(".side_nav_toggle_button").text(">>")):"yes"==h&&(h="no",$("#side_nav").removeClass("collapsed_nav"),$("#side_nav").addClass("uncollapsed_nav"),$("#main_contents").removeClass("collapsed_main_content"),$("#main_contents").addClass("uncollapsed_main_content"),$(".side_nav_options").animate({opacity:"1"}),$(".side_nav_toggle_button").text("<<"))};var m;e.side_nav_autotoggle=function(t){"off"==t?"no"==h&&(m=setTimeout(e.side_nav_toggle,1e3)):"on"==t&&clearTimeout(m)},e.listVirtualCollections(),e.selectProfile=function(e){n.info("going to Data Profile"),e||(n.error("missing irodsAbsolutePath"),i.danger("missing irodsAbsolutePath")),o.url("/profile/"),o.search("path",e)},e.selectGalleryView=function(){n.info("going to Gallery View"),o.url("/gallery/")},e.selectHierView=function(){n.info("going to Hierarchical View"),o.url("/home/")}}]).factory("virtualCollectionsService",["$http","$log","globals",function(e,t,n){var a=[],o=[];return{listUserVirtualCollections:function(){return t.info("getting virtual colls"),e({method:"GET",url:n.backendUrl("virtualCollection")}).success(function(e){a=e}).error(function(){a=[]})},listUserVirtualCollectionData:function(i){return t.info("listing virtual collection data"),i?e({method:"GET",url:n.backendUrl("virtualCollection/")+i}).success(function(e){a=e}).error(function(){a=[]}):void(o=[])}}}]).factory("downloadService",["$http","$log","globals",function(e,t,n){return{downloadSingle:function(e){if(t.info("dowloading single"),!e)throw t.error("no path provided"),"no path provided";window.open(n.backendUrl("download")+"?path="+e,"_blank")},downloadBundle:function(e){if(t.info("dowloading bundle"),!path)throw t.error("no path provided"),"no path provided";window.open(n.backendUrl("download")+"?path="+path,"_blank")}}}]).factory("collectionsService",["$http","$log","globals",function(e,t,n){var a={};return{selectVirtualCollection:function(e){},listCollectionContents:function(o,i,r){if(t.info("doing get of the contents of a virtual collection"),!o)throw t.error("recVcName is missing"),"reqMcName is missing";return i||(i=""),r||(r=0),t.info("requesting vc:"+o+" and path:"+i),e({method:"GET",url:n.backendUrl("collection/")+o,params:{path:i,offset:r}}).success(function(e){a=e.data}).error(function(){a={}})},addNewCollection:function(e,n){t.info("addNewCollection()")}}}]),angular.module("myApp.login",["ngRoute"]).config(["$routeProvider",function(e){e.when("/login",{templateUrl:"login/login.html",controller:"loginCtrl"})}]).controller("loginCtrl",["$scope","$log","$http","$location","MessageService","globals","$q","$timeout",function(e,t,n,a,o,i,r,l){var s=function(e,t,n,a,o,i,r){return{host:e,port:t,zone:n,userName:a,password:o,authType:i,resource:r}};e.animate_ir=function(){var e=event.pageX,n=event.pageY,a=$(".page_center"),o=Math.floor(Math.sqrt(Math.pow(e-(a.offset().left+a.width()/2),2)+Math.pow(n-(a.offset().top+a.height()/2),2)));$(".intro_screen_ir_shadow").css("width",o/8+100+"px"),$(".intro_screen_ir_shadow").css("opacity",1-o/700),$(".intro_screen_ir").css("opacity",.3+o/700);var i=$(".intro_screen_ir_shadow").width(),r=(a.offset().top-n)/2-50;$(".intro_screen_ir").css("top",r+"px"),$(".intro_screen_ir_white").css("top",r+"px");var l=(a.offset().left-e)/2-50;$(".intro_screen_ir").css("left",l+"px"),$(".intro_screen_ir_white").css("left",l+"px");var s=1.5*(a.offset().top-n)/2-i/2;$(".intro_screen_ir_shadow").css("top",s+"px");var c=1.5*(a.offset().left-e)/2-i/2;$(".intro_screen_ir_shadow").css("left",c+"px"),t.info(r+","+o)},e.close_intro=function(){$(".intro_screen").animate({opacity:"0"},function(){$(".intro_screen").css("display","none")})},e.submitLogin=function(){var o=s(e.login.host,e.login.port,e.login.zone,e.login.userName,e.login.password,e.login.authType,"");t.info("irodsAccount for host:"+o),n({method:"POST",url:i.backendUrl("login"),data:o,headers:{"Content-Type":"application/json"}}).then(function(e){t.info("login successful"+e);var n=i.getLastPath();return r.when(n)}).then(function(e){e?t.info("setting location to last path:"+e):(t.info("hard code to go home"),e="/home/home"),l(function(){a.path(e)}),t.info("end login success processing")})}}]),angular.module("myApp.metadata",["ngRoute"]).factory("metadataService",["$http","$log","$q","globals",function(e,t,n,a){return{listMetadataForPath:function(n){if(t.info("listMetadataForPath()"),!n)throw t.error("absolutePath is missing"),"absolutePath is missing";var o=e({method:"GET",url:a.backendUrl("metadata"),params:{irodsAbsolutePath:n}}).then(function(e){return t(e),e.data});return o},addMetadataForPath:function(n,o,i,r){if(t.info("addMetadataForPath()"),!n)throw t.error("absolutePath is missing"),"absolutePath is missing";if(!o)throw t.error("attribute is missing"),"attribute is missing";if(!i)throw Í,t.error("value is missing"),"value is missing";if(!r)throw t.error("unit is missing"),"unit is missing";var l=e({method:"PUT",url:a.backendUrl("metadata"),params:{irodsAbsolutePath:n,attribute:o,value:i,unit:r}}).then(function(e){return t.info(e),e.data});return l},deleteMetadataForPath:function(n,o,i,r){if(t.info("deleteMetadataForPath()"),!n)throw t.error("absolutePath is missing"),"absolutePath is missing";if(!o)throw t.error("attribute is missing"),"attribute is missing";if(!i)throw t.error("value is missing"),"value is missing";if(!r)throw t.error("unit is missing"),"unit is missing";var l=e({method:"DELETE",url:a.backendUrl("metadata"),params:{irodsAbsolutePath:n,attribute:o,value:i,unit:r}}).then(function(e){return t(e),e.data});return l},updateMetadataForPath:function(n,o,i,r,l,s,c){if(t.info("updateMetadataForPath()"),!n)throw t.error("absolutePath is missing"),"absolutePath is missing";var d=e({method:"POST",url:a.backendUrl("metadata"),params:{irodsAbsolutePath:n,attribute:o,value:i,unit:r,newAttribute:l,newValue:s,newUnit:c}}).then(function(e){return t.info(e),e.data});return d}}}]),angular.module("myApp.profile",["ngRoute"]).config(["$routeProvider",function(e){e.when("/profile",{templateUrl:"profile/profile.html",controller:"profileCtrl",resolve:{dataProfile:function(e,t){var n=t.retrieveDataProfile(e.current.params.path);return n}}})}]).directive("onLastRepeat",function(){return function(e,t,n){e.$last&&setTimeout(function(){e.$emit("onRepeatLast",t,n)},1)}}).controller("profileCtrl",["$scope","$log","Upload","$http","$location","MessageService","globals","breadcrumbsService","virtualCollectionsService","collectionsService","fileService","metadataService","dataProfile",function(e,t,n,a,o,i,r,l,s,c,d,u,p){e.dataProfile=p,e.$on("onRepeatLast",function(e,t,n){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?$(".ui-selectee").on("tap",function(e){var t=$("#select-result").empty();if(e.preventDefault(),$(e.target).hasClass("ui-selected")?$(e.target).removeClass("ui-selected"):$(e.target).addClass("ui-selected"),$(".ui-selected").length>1)t.append($(".ui-selected").length+" files");else if(1==$(".ui-selected").length){var n=$(".ui-selected").text();t.append(n)}else 0==$(".ui-selected").length}):$(".selectable").selectable({stop:function(){$(".q_column , .list_group_header").removeClass("ui-selected"),$(".q_column , .list_group_header").removeClass("ui-selectee"),$("li.ui-selected").length>1||1==$("li.ui-selected").length||0==$("li.ui-selected").length}})}),e.listVirtualCollections=function(){return t.info("getting virtual colls"),a({method:"GET",url:r.backendUrl("virtualCollection")}).success(function(t){e.virtualCollections=t}).error(function(){e.virtualCollections=[]})},e.listVirtualCollections();var _="yes";e.side_nav_toggle=function(){"no"==_?(_="yes",$(".side_nav_options").animate({opacity:"0"}),$("#side_nav").removeClass("uncollapsed_nav"),$("#side_nav").addClass("collapsed_nav"),$("#main_contents").removeClass("uncollapsed_main_content"),$("#main_contents").addClass("collapsed_main_content"),$(".side_nav_toggle_button").text(">>")):"yes"==_&&(_="no",$("#side_nav").removeClass("collapsed_nav"),$("#side_nav").addClass("uncollapsed_nav"),$("#main_contents").removeClass("collapsed_main_content"),$("#main_contents").addClass("uncollapsed_main_content"),$(".side_nav_options").animate({opacity:"1"}),$(".side_nav_toggle_button").text("<<"))};var f;e.side_nav_autotoggle=function(t){"off"==t?"no"==_&&(f=setTimeout(e.side_nav_toggle,1e3)):"on"==t&&clearTimeout(f)},e.$watch("files",function(){e.upload(e.files)}),e.multiple=!0,e.upload=function(a){if(a&&a.length){$(".upload_container").css("display","none"),$(".upload_container_result").css("display","block");for(var o=0;o<a.length;o++){var i=a[o];$(".upload_container_result ul").append('<li id="uploading_item_'+o+'" class="light_back_option_even"><div class="col-xs-7 list_content"><img src="images/data_object_icon.png">'+i.name+"</div></li>"),n.upload({url:r.backendUrl("file"),fields:{collectionParentName:e.dataProfile.parentPath+"/"+e.dataProfile.childName},file:i}).progress(function(e){var n=parseInt(100*e.loaded/e.total);t.info(n)}).success(function(e,t,n,a){console.log("file "+a.file.name+"uploaded. Response: "+e)})}}},e.delete_action=function(){var n="path="+e.dataProfile.parentPath+"/"+e.dataProfile.childName;return t.info("Deleting:"+n),a({method:"DELETE",url:r.backendUrl("file")+"?"+n}).success(function(e){alert("Deletion completed"),window.history.go(-1)})},e.rename_action=function(){var n=e.dataProfile.parentPath+"/"+e.dataProfile.childName,o=$("#new_renaming_name").val(),i=window.location,l=String(i).lastIndexOf("%2F"),s=String(i).substr(0,l),s=s+"%2F"+o;return t.info("Renaming:"+n),a({method:"PUT",url:r.backendUrl("rename"),params:{path:n,newName:o}}).success(function(e){location.assign(s)})},e.star_action=function(){var t=e.dataProfile.parentPath+"/"+e.dataProfile.childName;d.starFileOrFolder(t).then(function(t){e.dataProfile.starred=!0})},e.unstar_action=function(){var t=e.dataProfile.parentPath+"/"+e.dataProfile.childName;d.starFileOrFolder(t).then(function(t){e.dataProfile.starred=!1})},e.upload_pop_up_open=function(){$(".pop_up_window").fadeIn(100),$(".uploader").fadeIn(100)},e.rename_pop_up_open=function(){$(".pop_up_window").fadeIn(100),$(".renamer").fadeIn(100);var e=$(".ui-selected").children(".list_content").children(".data_object").text();$(".selected_object").append(e)},e.delete_pop_up_open=function(){$(".pop_up_window").fadeIn(100),$(".delete_container ul").append('<li class="light_back_option_even"><div class="col-xs-7 list_content"><img src="images/data_object_icon.png">'+e.dataProfile.childName+"</div></li>"),$(".deleter").fadeIn(100)},e.pop_up_close=function(){$(".pop_up_window").fadeOut(100,function(){$(".upload_container").css("display","block"),$(".upload_container_result").html("<ul></ul>"),$(".upload_container_result").css("display","none"),$(".uploader").fadeOut(100),$(".deleter").fadeOut(100),location.reload()})},e.pop_up_close_asynch=function(){$(".pop_up_window").fadeOut(100,function(){$(".upload_container").css("display","block"),$(".upload_container_result").html("<ul></ul>"),$(".upload_container_result").css("display","none"),$(".metadata_editor").fadeOut(100),$(".metadata_adder").fadeOut(100),$(".metadata_deleter").fadeOut(100)})},e.available_metadata=e.dataProfile.metadata,e.add_metadata_pop_up=function(){$(".pop_up_window").fadeIn(100),$(".metadata_adder").fadeIn(100)},e.edit_metadata_pop_up=function(){$(".pop_up_window").fadeIn(100),$(".metadata_editor").fadeIn(100),$("#edit_metadata_attribute").val($(".metadata_item.ui-selected").children(".metadata_attribute").text()),$("#edit_metadata_value").val($(".metadata_item.ui-selected").children(".metadata_value").text()),$("#edit_metadata_unit").val($(".metadata_item.ui-selected").children(".metadata_unit").text()),e.old_metadata_attribute=$(".metadata_item.ui-selected").children(".metadata_attribute").text(),e.old_metadata_value=$(".metadata_item.ui-selected").children(".metadata_value").text(),e.old_metadata_unit=$(".metadata_item.ui-selected").children(".metadata_unit").text(),alert(e.old_metadata_attribute+"  "+e.old_metadata_value+"  "+e.old_metadata_unit)},e.delete_metadata_pop_up=function(){$(".pop_up_window").fadeIn(100),e.delete_objects=$(".metadata_item.ui-selected"),t.info(e.delete_objects),$(".metadata_delete_container ul").empty(),$(".metadata_delete_container ul").append('<li class="light_back_option_even"><div class="q_column"><b>ATTRIBUTE</b></div><div class="q_column"><b>VALUE</b></div><div class="q_column"><b>UNIT</b></div></li>'),e.delete_objects.each(function(){$(".metadata_delete_container ul").append('<li class="light_back_option_even"><div class="q_column">'+$(this).children(".metadata_attribute").text()+'</div><div class="q_column">'+$(this).children(".metadata_value").text()+'</div><div class="q_column">'+$(this).children(".metadata_unit").text()+"</div></li>")}),$(".metadata_deleter").fadeIn(100)},e.metadata_add_action=function(){var t=e.dataProfile.parentPath+"/"+e.dataProfile.childName,n=$("#new_metadata_attribute").val(),o=$("#new_metadata_value").val(),i=$("#new_metadata_unit").val();u.addMetadataForPath(t,n,o,i).then(function(){a({method:"GET",url:r.backendUrl("file"),params:{path:e.dataProfile.parentPath+"/"+e.dataProfile.childName}}).success(function(t){e.new_meta=t,e.available_metadata=e.new_meta.metadata}),e.pop_up_close_asynch()})},e.metadata_edit_action=function(){var t=e.dataProfile.parentPath+"/"+e.dataProfile.childName,n=$("#edit_metadata_attribute").val(),o=$("#edit_metadata_value").val(),i=$("#edit_metadata_unit").val();u.updateMetadataForPath(t,e.old_metadata_attribute,e.old_metadata_value,e.old_metadata_unit,n,o,i).then(function(){a({method:"GET",url:r.backendUrl("file"),params:{path:e.dataProfile.parentPath+"/"+e.dataProfile.childName}}).success(function(t){e.new_meta=t,e.available_metadata=e.new_meta.metadata}),e.pop_up_close_asynch()})},e.green_action_toggle=function(e){var t=e.currentTarget.nextElementSibling,n=e.currentTarget.parentElement;$(t).toggle("normal"),$(n).toggleClass("green_toggle_container_open")},e.getBreadcrumbPaths=function(){return e.dataProfile?(l.setCurrentAbsolutePath(e.dataProfile.parentPath),l.getWholePathComponents()):[]},e.getDownloadLink=function(){return r.backendUrl("download")+"?path="+e.dataProfile.domainObject.absolutePath},e.goToBreadcrumb=function(e){return e?(o.path("/home/root"),void o.search("path",l.buildPathUpToIndex(e))):void t.error("cannot go to breadcrumb, no index")}}]);